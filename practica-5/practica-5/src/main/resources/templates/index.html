<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gr치ficos en Tiempo Real</title>

    <!-- Librer칤as necesarias -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.3/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #121212, #1e1e1e);
            color: #ffffff;
            font-family: 'Poppins', sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #ffa726;
        }

        h2 {
            font-size: 22px;
            color: #29b6f6;
            margin-bottom: 10px;
        }

        .chart-container {
            display: flex;
            justify-content: center;
            gap: 15px;  /* 游댳 Reduce la separaci칩n entre gr치ficos */
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .chart-box {
            background: #1b1e24; /* 游댳 Color m치s oscuro para mejor contraste */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.5);
            width: 80%;  /* 游댳 Aumenta el ancho de los gr치ficos */
            min-width: 450px;
            max-width: 900px; /* 游댳 Permite un tama침o m치s grande */
        }

        .chart-box canvas {
            width: 100% !important;
            height: 600px !important; /* 游댳 Aumenta la altura del gr치fico */
        }


        @media (max-width: 800px) {
            .chart-box {
                width: 90%;
            }
        }
    </style>
</head>
<body>

<h1>游늵 Datos de Sensores en Tiempo Real</h1>

<div class="chart-container">
    <div class="chart-box">
        <h2>游꺄 Temperatura</h2>
        <canvas id="temperaturaChart"></canvas>
    </div>
    <div class="chart-box">
        <h2>游눦 Humedad</h2>
        <canvas id="humedadChart"></canvas>
    </div>
</div>

<script>
    Chart.register('chartjs-adapter-luxon');

    const ctxTemp = document.getElementById('temperaturaChart').getContext('2d');
    const ctxHum = document.getElementById('humedadChart').getContext('2d');

    const temperaturaChart = new Chart(ctxTemp, {
        type: 'line',
        data: { labels: [], datasets: [{ label: 'Temperatura', data: [], borderColor: '#ff7043', backgroundColor: 'rgba(255, 112, 67, 0.2)', fill: true }] },
        options: {
            responsive: true,
            maintainAspectRatio: true,  // 游댳 SOLUCI칍N: Mantener el aspecto
            scales: {
                x: {
                    type: 'time',
                    time: {
                        unit: 'minute',
                        tooltipFormat: 'dd/MM/yyyy HH:mm:ss'
                    },
                    title: { display: true, text: 'Tiempo', color: '#ffffff' }
                },
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Temperatura (춿C)', color: '#ffffff' }
                }
            },
            plugins: {
                legend: { labels: { color: '#ffffff' } }
            }
        }
    });

    const humedadChart = new Chart(ctxHum, {
        type: 'line',
        data: { labels: [], datasets: [{ label: 'Humedad', data: [], borderColor: '#42a5f5', backgroundColor: 'rgba(66, 165, 245, 0.2)', fill: true }] },
        options: {
            responsive: true,
            maintainAspectRatio: true,  // 游댳 SOLUCI칍N: Mantener el aspecto
            scales: {
                x: {
                    type: 'time',
                    time: {
                        unit: 'minute',
                        tooltipFormat: 'dd/MM/yyyy HH:mm:ss'
                    },
                    title: { display: true, text: 'Tiempo', color: '#ffffff' }
                },
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Humedad (%)', color: '#ffffff' }
                }
            },
            plugins: {
                legend: { labels: { color: '#ffffff' } }
            }
        }
    });

    // Configurar WebSockets con STOMP
    const socket = new SockJS('/ws');
    const stompClient = Stomp.over(socket);

    stompClient.connect({}, function (frame) {
        console.log("游니 Conectado a WebSocket!");

        stompClient.subscribe('/topic/datos', function (message) {
            const data = JSON.parse(message.body);

            const fecha = luxon.DateTime.fromFormat(data.fechaGeneracion, "dd/MM/yyyy HH:mm:ss").toJSDate();

            temperaturaChart.data.labels.push(fecha);
            temperaturaChart.data.datasets[0].data.push(data.temperatura);
            temperaturaChart.update();

            humedadChart.data.labels.push(fecha);
            humedadChart.data.datasets[0].data.push(data.humedad);
            humedadChart.update();

            console.log("游닐 Datos recibidos y graficados:", data);
        });
    });
</script>

</body>
</html>
